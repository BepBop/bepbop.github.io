---
import Card from "../atoms/card.astro";
import projectList from "/src/content/projects-list.json";
---

<div id="Projects">
  <div class="card-container grd">
    {
      projectList.map((item) => (
        <Card
          title={item.title}
          tag={item.tag}
          eyebrow={item.eyebrow}
          paragraph={item.paragraph}
          link={`/Case Study/${item.title}`}
          thumbnail={`/thumbnail/${item.thumbnail}`}
        />
      ))
    }
  </div>

  <dialog
    id="contactDialog"
    class="contact-dialog"
    aria-labelledby="dialogTitle"
    aria-describedby="dialogBody"
  >
    <header class="flex">
      <h2 id="dialogTitle" class="dialog-title">Let's Connect</h2>
      <button id="closeDialogBtn" class="dialog-close-btn" aria-label="Close"
        >&times;</button
      >
    </header>

    <p id="dialogBody" class="dialog-body">
      Thank you for showing interest in this project. I’d be glad to share more
      insights and details with you. The Contact Me button below will open your
      email client with a direct email to anjaygyan@gmail.com!
    </p>

    <a class="btn-contact" href="mailto:AnjayGyan@gmail.com">
      Contact Me
      <img src="/img/arrow.svg" alt="" />
    </a>
  </dialog>
</div>

<style>
  #Projects {
    //padding: 2.5% 0 5% 0;
    //padding: clamp(72px, 6vw + 1rem, 120px) 2.5% 180px 2.5%;
    //padding: clamp(36px, 2.4vw + 1rem, 72px) 2.5% 108px 2.5%;
    //height: fit-content;
    overflow-x: auto;
    transition: all 1s ease-in-out;
    padding: 2.5%;
    position: relative;
    scroll-snap-type: x mandatory;
  }

  @scope (#Projects) {
    .grd {
      display: grid;
      grid-template: auto / repeat(9, minmax(380px, 1fr));
      gap: clamp(1.2rem, 1.5vw, 2rem);
      overflow-x: auto;
      cursor: none;
      padding: 5% 0;

      @media (width <= 1000px) {
        grid-template: auto / repeat(auto-fill, minmax(380px, auto));
      }
    }
  }

  .contact-dialog {
    padding: 32px;
    background: #ffffff;
    color: #4b5563;
    border: 1px solid #d1d5db;
    border-radius: 0;
    font-family: var(--font-sans), sans-serif;
    max-width: 500px;
    width: 80%;
    cursor: default;

    &::backdrop {
      background: rgba(31, 41, 55, 0.75);
    }

    .flex {
      align-items: flex-start;
      justify-content: center;
      display: flex;
    }

    .dialog-title {
      flex-grow: 1;
      margin: 0 0 16px 0;
      font: 500 var(--font-size-10) var(--font-sans, sans-serif);
      color: #111827;
    }

    .dialog-body {
      margin: 0 0 24px 0;
      color: #4b5563;
      font: 400 var(--font-size-6) / 1.64 var(--font-sans, sans-serif);
    }

    .dialog-close-btn {
      flex-shrink: 0;
      padding: 0;
      line-height: 1;
      font-size: 28px;
      color: #9ca3af;
      background: none;
      border: none;
      cursor: pointer;
      transition: color 0.15s ease;

      &:hover {
        color: #1f2937;
      }
    }

    .btn-contact {
      &,
      &:link,
      &:visited {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 12px 24px;
        background-color: var(--green);
        color: #111827 !important;
        text-decoration: none;
        border: none;
        border-radius: 6px;
        font: 500 var(--font-size-6) var(--font-sans, sans-serif);
        cursor: pointer;
        transition:
          box-shadow 0.2s ease-out,
          filter 0.2s ease-out;
      }

      &:hover {
        box-shadow:
          0px 0px 0px 1px rgba(124, 252, 0, 0.1),
          0px 5px 10px 0px rgba(124, 252, 0, 0.2),
          0px 15px 40px 0px rgba(124, 252, 0, 0.4);
      }

      &:active {
        box-shadow:
          0px 0px 0px 1px rgba(124, 252, 0, 0.1),
          0px 5px 10px 0px rgba(124, 252, 0, 0.2),
          0px 15px 40px 0px rgba(124, 252, 0, 0.4);
      }

      svg {
        width: 16px;
        height: 16px;
      }
    }
  }
</style>

<script>
  // /src/scripts/contact-dialog.js
  function initContactDialog() {
    const dialog = document.getElementById("contactDialog");
    const openButtons = document.querySelectorAll(".card-container");
    const closeButton = document.getElementById("closeDialogBtn");

    // Exit if dialog not present on current page
    if (!dialog || !openButtons.length || !closeButton) return;

    // Prevent duplicate event binding on repeated navigations
    if (dialog.dataset.bound) return;
    dialog.dataset.bound = "true";

    // Open dialog
    openButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        dialog.showModal();
        document.body.classList.add("dialog-open");
      });
    });

    // Close dialog (via close button)
    closeButton.addEventListener("click", () => {
      dialog.close();
    });

    // Close on backdrop click
    dialog.addEventListener("click", (e) => {
      if (e.target === dialog) {
        dialog.close();
      }
    });

    // Handle all closing methods (ESC, button, backdrop)
    dialog.addEventListener("close", () => {
      document.body.classList.remove("dialog-open");
    });
  }

  // ✅ Run once at first load
  initContactDialog();

  // ✅ Re-run after each Astro client-side navigation
  document.addEventListener("astro:page-load", initContactDialog);
</script>
